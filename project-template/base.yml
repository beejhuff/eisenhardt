version: '2'

services:
  magento_webserver:
    image: "nginx:alpine"
    networks:
      - "magento"
    volumes:
      - "./servers/magento_webserver/etc/nginx.conf:/etc/nginx/nginx.conf"
    volumes_from:
      - "magento_appserver"
    depends_on:
      - "magento_appserver"

  magento_appserver:
    image: "redboxdigital/php:7.0"
    networks:
      - "magento"
    volumes:
      - "./servers/magento_appserver/etc/php.ini:/usr/local/etc/php/php.ini"
    volumes_from:
      - "magento_appdata"
    depends_on:
      - "magento_database"
      - "magento_mail"
      - "magento_cache"
      - "magento_fpc"
      - "magento_session"
      - "magento_messagequeue"

  magento_appdata:
    image: "alpine"
    command: "sh"
    volumes:
      - "./magento:/mnt/magento"

  magento_database:
    image: percona:5.6
    networks:
      - "magento"
    volumes:
      - "./data:/var/lib/mysql"
      - "./servers/magento_database/etc/mysql/my.cnf:/etc/mysql/my.cnf"
    environment:
      MYSQL_ROOT_PASSWORD: "root"

  magento_cache:
    image: "redis:alpine"
    networks:
      - "magento"
  magento_fpc:
    image: "redis:alpine"
    networks:
      - "magento"
  magento_session:
    image: "redis:alpine"
    networks:
      - "magento"

  magento_messagequeue:
    image: "rabbitmq:management-alpine"
    networks:
      - "magento"

networks:
  magento:
    driver: bridge
